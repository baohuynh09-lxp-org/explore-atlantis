version: 2
projects:
- name: network
  dir: deployment/network
  workflow: network
  apply_requirements: [mergeable] #Requirements that must be satisfied before atlantis apply can be run

- name: jumphost
  dir: deployment/jumphost
  workflow: jumphost
  apply_requirements: [mergeable] #Requirements that must be satisfied before atlantis apply can be run


workflows:
  network:
    plan:
      steps:
      - run: rm -rf .terraform ; echo "COMMENT_ARGS:# $COMMENT_ARGS"
      - init:
          extra_args: [-backend-config=../backends/${COMMENT_ARGS}.backend.tf]
      - plan:
          extra_args: [-var-file=../env/${COMMENT_ARGS}.tfvars]

    apply:
      steps:
      - run: rm -rf .terraform ; echo "COMMENT_ARGS:# $COMMENT_ARGS"
      - init:
          extra_args: [-backend-config=../backends/${COMMENT_ARGS}.backend.tf]
      - plan:
          extra_args: [-var-file=../env/${COMMENT_ARGS}.tfvars]
